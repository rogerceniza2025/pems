-- Test Database Seed Script
-- Creates test tenants and data for comprehensive testing

-- Clean up existing test data
DELETE FROM "TillSession";
DELETE FROM "Receipt";
DELETE FROM "Transaction";
DELETE FROM "Account";
DELETE FROM "Enrollment";
DELETE FROM "CourseSection";
DELETE FROM "Course";
DELETE FROM "Student";
DELETE FROM "UserRole";
DELETE FROM "RolePermission";
DELETE FROM "Role";
DELETE from "Permission";
DELETE FROM "UserAuthProvider";
DELETE FROM "UserProfile";
DELETE FROM "User";
DELETE FROM "TenantSetting";
DELETE FROM "Tenant";

-- Create test tenants
INSERT INTO "Tenant" (id, name, slug, timezone) VALUES
('00000000-0000-0000-0000-000000000001', 'Test School Alpha', 'test-alpha', 'Asia/Manila'),
('00000000-0000-0000-0000-000000000002', 'Test School Beta', 'test-beta', 'Asia/Manila'),
('00000000-0000-0000-0000-000000000003', 'Test School Gamma', 'test-gamma', 'Asia/Manila');

-- Create test users
INSERT INTO "User" (id, tenant_id, email, is_active, is_system_admin) VALUES
('10000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'admin@test-alpha.com', true, false),
('10000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000002', 'admin@test-beta.com', true, false),
('10000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000003', 'admin@test-gamma.com', true, false),
('20000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'system@pems.ph', true, true);

-- Create test students
INSERT INTO "Student" (id, tenant_id, student_no, first_name, last_name) VALUES
('30000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'ALPHA-001', 'Juan', 'Dela Cruz'),
('30000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'ALPHA-002', 'Maria', 'Santos'),
('30000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000002', 'BETA-001', 'Jose', 'Reyes'),
('30000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000003', 'GAMMA-001', 'Ana', 'Garcia');

-- Create test accounts
INSERT INTO "Account" (id, tenant_id, code, name, type, balance) VALUES
('40000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'ALPHA-ACC-001', 'Juan Dela Cruz', 'student', 1500.50),
('40000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000002', 'BETA-ACC-001', 'Jose Reyes', 'student', 2200.00),
('40000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000003', 'GAMMA-ACC-001', 'Ana Garcia', 'student', 750.25);

-- Create test courses
INSERT INTO "Course" (id, tenant_id, code, title) VALUES
('50000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'MATH-101', 'Basic Mathematics'),
('50000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000002', 'SCI-101', 'Basic Science'),
('50000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001', 'ENG-101', 'English 101');

-- Create test transactions
INSERT INTO "Transaction" (id, tenant_id, account_id, amount, direction, transaction_type) VALUES
('60000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', 500.00, 'credit', 'payment'),
('60000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000002', '40000000-0000-0000-0000-000000000002', 300.00, 'debit', 'purchase'),
('60000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000003', '40000000-0000-0000-0000-000000000003', 100.00, 'credit', 'refund');

-- Create tenant settings
INSERT INTO "TenantSetting" (id, tenant_id, key, value) VALUES
('70000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'school.theme', 'light'),
('70000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'school.currency', 'PHP'),
('70000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000002', 'school.theme', 'dark'),
('70000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000003', 'school.currency', 'PHP');

-- Create roles and permissions
INSERT INTO "Permission" (id, action, resource, resource_scope, description) VALUES
('80000000-0000-0000-0000-000000000001', 'read', 'students', 'tenant', 'View student information'),
('80000000-0000-0000-0000-000000000002', 'write', 'students', 'tenant', 'Create and edit students'),
('80000000-0000-0000-0000-000000000003', 'read', 'accounts', 'tenant', 'View account information'),
('80000000-0000-0000-0000-000000000004', 'write', 'accounts', 'tenant', 'Create and edit accounts');

INSERT INTO "Role" (id, tenant_id, name, slug, is_builtin) VALUES
('90000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'School Administrator', 'school-admin', false),
('90000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000002', 'School Administrator', 'school-admin', false),
('90000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000003', 'School Administrator', 'school-admin', false);

-- Create user roles
INSERT INTO "UserRole" (id, user_id, role_id) VALUES
('A0000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '90000000-0000-0000-0000-000000000001'),
('A0000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000002', '90000000-0000-0000-0000-000000000002'),
('A0000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000003', '90000000-0000-0000-0000-000000000003');

-- Create role permissions
INSERT INTO "RolePermission" (id, role_id, permission_id) VALUES
('B0000000-0000-0000-0000-000000000001', '90000000-0000-0000-0000-000000000001', '80000000-0000-0000-0000-000000000001'),
('B0000000-0000-0000-0000-000000000002', '90000000-0000-0000-0000-000000000001', '80000000-0000-0000-0000-000000000002'),
('B0000000-0000-0000-0000-000000000003', '90000000-0000-0000-0000-000000000001', '80000000-0000-0000-0000-000000000003'),
('B0000000-0000-0000-0000-000000000004', '90000000-0000-0000-0000-000000000002', '80000000-0000-0000-0000-000000000001'),
('B0000000-0000-0000-0000-000000000005', '90000000-0000-0000-0000-000000000003', '80000000-0000-0000-0000-000000000001');